section.dashboard
  .w3-row-padding.w3-border-bottom
    .w3-col.m2 
      h5.strong Score Teams
    .w3-col.m6
      = link_to icon('fas fa-arrow-left', 'Cancel - List Games'),  games_path, class: 'btn btn-warning mr-2'
      - if @game.state[:can_delete]

        = link_to @game, 
           title: 'Destroy incomplete game', 
           class: 'btn btn-danger w100', method: :delete, data: { confirm: 'Are you sure?', remote: true } do
           = icon('fas fa-trash','Delete Incomplete Game')



    .w3-col.m4.pt-breadcrumb
      .crumbs
        = link_to icon('fas fa-arrow-left', 'Back'), 'javascript:history.back()', class: 'btn btn-secondary '
        span.span-btn= Game

= render partial:'games/shared/event'
= form_with(url:update_scores_games_pending_path(@game), method: :patch, data: { type: "html"} )do |f|
  .w3-row-padding
    .s12.m3.w3-col
      / [data-sticky-container]
      .sticky-col
        .lime-link-btn.btn-primary.w100= f.submit("Update Scores", class:'button w100 w3-disabled strong',autocomplete: :off,disabled: :disabled,id:'submit_form')
        hr.underline
        .lime-link-btn.btn-warning.w100 = link_to "Cancel", @game.namespace_url, class:'link-btn strong'
        hr.underline
        - link_params = params[:team].present? ? {team:params[:team]} : {}
        - useKeys = Current.group.use_keyboard_scoring
        - if params[:keys].present? 
          - if params[:keys] == '1'
            - useKeys = true
          - else
            - useKeys = false
        - if useKeys
          - link_params[:keys] = '0'
          .lime-link-btn.w100 =  link_to "Use Mouse Entry", score_teams_games_pending_path(@game,link_params),class:'link-btn strong '
        -else
          - link_params[:keys] = '1'
          .lime-link-btn.w100 = link_to "Use Keyboard Entry", score_teams_games_pending_path(@game,link_params),class:'link-btn strong '
        hr.underline.w100
    - select_points = !useKeys
    .s12.m9.w3-col
      #status_box.w3-text-red.strong No team(s) have been scored

      - teams = @game.game_teams(params[:team])
      - teams.each_with_index do |(team,mates),i|
         
        -tq = mates.sum(:quota)
        -sq = tq/2.0
        -hq = (tq/18.0).round(2)
        table.small-table.w100[data-controller="scoreTeam someJunk"]

          tr
            th.w50p colspan="4" 
              - if @game.stats[:makeup] == "individuals"
                = "Tee Time #{team}"
              - else
                = "Team - #{team} Quota:#{tq} Side: #{sq} Hole: #{hq}"
              = hidden_field_tag("team[#{team}][quota]",tq,data:{target:"scoreTeam.teamQuota"})
              / div[id="teamUpdate#{i}" style="display:none;" data-action="click->scoreTeam#compute"]
            th.w15p[data-target="scoreTeam.teamFront someJunk.whooa"]
            th.w15p[data-target="scoreTeam.teamBack"]
            th.w15p[data-target="scoreTeam.teamTotal"]
            th.w05p[data-target="scoreTeam.teamPM"]
      
          tr
            th Name
            th Tee
            th Quota
            th Side
            th Front
            th Back
            th Total
            th &#177;

          - mates.each do |mate|
            - side = mate.quota / 2.0
            tr[data-controller="scoreMate"]
              td
                = mate.full_name
                / = hidden_field_tag('jsteam',i,data:{target:"scoreMate.jsTeam"})
              td= mate.tee
              - if mate.limited.present?
                - q = "#{mate.quota}  &#177;#{mate.limited }".html_safe
              - else
                - q = mate.quota
              td
                = q
                = hidden_field_tag("participant[#{mate.id}][quota]",mate.quota,data:{target:"scoreMate.mateQuota"})
              td
                = side
                = hidden_field_tag("participant[#{mate.id}][team]",team)
              - if select_points
                - opt = pulled_options(mate.quota)
                / p.mb-3 " #{mate.full_name} #{mate.quota} #{mate.front} #{mate.back} #{mate.total}"
                td= select_tag("participant[#{mate.id}][front]", options_for_select(opt[:side],\
                  mate.front.present? && !mate.front.zero? ? mate.front : 'Select')\
                  , data:{target:'scoreMate.mateFront scoreTeam.mateFront',action:"change->scoreMate#front change->scoreTeam#compute"},class:" w3-select")
                td= select_tag("participant[#{mate.id}][back]", options_for_select(opt[:side],\
                  mate.back.present? && !mate.back.zero? ? mate.back : 'Select'),
                    data:{target:'scoreMate.mateBack scoreTeam.mateBack someJunk.ohno',
                    action:"change->scoreMate#back change->scoreTeam#compute"},
                    class:"w3-select")
              - else
                td= number_field_tag("participant[#{mate.id}][front]", mate.front,data:{target:'scoreMate.mateFront scoreTeam.mateFront',action:"change->scoreMate#front change->scoreTeam#compute"},class:"w100")
                td= number_field_tag("participant[#{mate.id}][back]",mate.back, data:{target:'scoreMate.mateBack scoreTeam.mateBack',action:"change->scoreMate#back change->scoreTeam#compute"},class:"w100")
              td= text_field_tag("participant[#{mate.id}][total]",mate.total, disabled:true, data:{target:'scoreMate.mateTotal scoreTeam.mateTotal'},class:"w100")
              th[data-target="scoreMate.matePM scoreTeam.matePM" class='mate-pm'] 
                - if mate.total.present?
                  = mate.total - mate.quota
        hr.underline
